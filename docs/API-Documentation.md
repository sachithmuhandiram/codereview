# API document

This will describe publicly exposed APIs in the system, their inputs and outputs. Also a short description about how they work internally.

1. `gateway:port/login`<br>
    Method : `GET`

    This will return login page to user. Also adds a `logintoken` to the page, Which will be to `userlogin` route.<br>
    `logintoken` is valid for 10 minutes.

2. `gateway:port/userlogin`<br>
    Method : `POST`
    
    Inputs :

    * Username : email address (field name = email)
    * Password : any string    (field name = password)
    * Login token : token ( filed name = logintoken)

    All inputs are mandetory. Route will first check whether given email address has a valid email syntax  using regular expression. If so, then checks whether password field is empty. If so returns back to `gateway:port/login`.
    If `username` and `password` syntax validated, then it checks whether there is a record for `logintoken`. If `login_token` in `api_gateway` databases. It sends to `User Service` to check username and password combination.<br>

    After sending `username` and `password` to User Service, that login token will be deleted from database.

3. `gateway:port/createsession` (Internal) <br>
    Method : `GET`

    Inputs : From User Service <br>
    * uuid          : Unique ID generated by Gatway when it receives first request.
    * authorized    : If user authentication success, this is set to `1` by user service, else `0`

    If user is authenticated, then JWT is generated to add to response and send `/home` route.

4. `gateway:port/home`<br>
    Method : `GET`

    This is Home page for individual user. When a request hits here, checks whether it has a valid JWT, if it doesnt then redirect to `/login` route.<br>
    Valid JWT expires time will increase (need to update).

5. `gateway:port/email`
    Method : `GET`<br>

    This will send a form UI to enter their email address. This does not handle JWT yet, next version this will be implemented. <br>
    Data will be posted to `gateway:port/getemail`.

6. `gateway:port/getemail`<br>
    Method : `POST`

    When a user wants to register for the system, this route will get `email` address and check whether its a `POST` ,and then validate email syntax.<br>
    Then email is sent to check whether email associated with a user account.<br>

    If email associats with an user account, then email will be sent to user to `login`<br>
    If email doent not have an account, a register email will be sent.

    - Tokens are inserted with email link, and need to make this into database and validating the process.

7. `gateway:port/register`<br>
    Method : `GET`

    This will bring User registration form to user. Page will be shown with after adding `registertoken` cookie. Initial stage following user data will be taken:
    * First Name            : `string`
    * Last Name             : `string`
    * Date of Birth         : `date`
    * Email address ( will be uneditable)
    * Password              : `string`
    * Retyped Password      : `string`

    Here password wont check for special character etc. We will advice users to use easy to remember, yet hard password. 
    Eg : <br>
    `this is fun`    , common word cracking would take 2537 years.<br>
    `du-bi-du-bi-dub` , bruteforce will take 531855448467 years to break.
    [Software Security](https://www.coursera.org/learn/usable-security/home/welcome)

    In next version,will try to integrate avoiding common word passwords with a help for some online directory.

8. `gateway:port/userregister`<br>
    Method : `POST`

    This will first check whether form has valid `registertoken`, if it doesnt have a valid `registertoken`, then user will be redirected to `gateway:port/register` route.

    If user has a valid `registertoken` form data will be taken and check whether user entered `password` and `retypedpassword` matches. If not match user will again redirected to `gateway:port/register` route.

    Then password is hashed and passed details to `User-Service`


    
